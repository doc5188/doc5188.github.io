---
layout: post
title: "Mysql解决The total number of locks exceeds the lock table size错误"
categories: 数据库
tags: [mysql]
date: 2014-12-19 10:34:42
---

<p class="p0" style="margin-bottom: 0pt; margin-top: 0pt;"><span style="font-size: 10.5pt; font-family: '宋体';">在操作<font face="Times New Roman">mysql</font><font face="宋体">数据库表时出现以下错误。</font></span><span style="font-size: 10.5pt; font-family: '宋体';"></span></p><p class="p0" style="margin-bottom: 0pt; margin-top: 0pt;"><a href="/upload/images/25266990_1343698912z4O9.jpg" target="_blank"><img src="/upload/images/25266990_1343698912z4O9.jpg" height="246" border="0" width="530"/></a><br><span style="font-size: 10.5pt; font-family: '宋体';"></span></p><p class="p0" style="margin-bottom: 0pt; margin-top: 0pt;"><span style="font-size: 10.5pt; font-family: 'Times New Roman';">网上<font face="Times New Roman">google</font><font face="宋体">搜索相关问题，发现</font></span><span style="font-size: 10.5pt; font-family: '宋体';">一位外国牛人这么解释</span><span style="font-size: 10.5pt; font-family: 'Times New Roman';">：</span></p><p class="p0" style="margin-bottom: 0pt; margin-top: 0pt;"><br><br></p><div id="codeText" class="codeText"><ol style="margin: 0pt 1px 0pt 0pt; padding: 5px 0pt;" start="1" class="dp-css"><li>If you're running an operation on a large number of rows within a table that uses the InnoDB storage engine, you might see this error:</li><li><br></li><li>    ERROR 1206 (HY000): The total number of locks exceeds the lock table size</li><li><br></li><li>    MySQL is trying to tell you that it doesn't have enough room to store all of the row locks that it would need to execute your query. The only way to fix it for sure is to adjust innodb_buffer_pool_size and restart MySQL. By default, this is set to only 8MB, which is too small for anyone who is using InnoDB to do anything.</li><li><br></li><li>    If you need a temporary workaround, reduce the amount of rows you're manipulating in one query. For example, if you need to delete a million rows from a table, try to delete the records in chunks of 50,000 or 100,000 rows. If you're inserting many rows, try to insert portions of the data at a single time.</li></ol></div><br><span style="font-size: 10.5pt; font-family: 'Times New Roman';"></span><span style="font-size: 10.5pt; font-family: 'Times New Roman';"></span>
<p class="p0" style="margin-bottom: 0pt; margin-top: 0pt;"><span style="font-size: 10.5pt; font-family: 'Times New Roman';">原来是<font face="Times New Roman">InnoDB</font><font face="宋体">表执行大批量数据的更新，插入，删除操作时会出现这个问题，需要调整</font><font face="Times New Roman">InnoDB</font><font face="宋体">全局的</font><font face="Times New Roman">innodb_buffer_pool_size</font><font face="宋体">的值来解决这个问题</font></span><span style="font-size: 10.5pt; font-family: '宋体';">，并且重启</span><span style="font-size: 10.5pt; font-family: '宋体';">mysql<font face="宋体">服务。</font></span><span style="font-size: 10.5pt; font-family: '宋体';"></span></p><p class="p0" style="margin-bottom: 0pt; margin-top: 0pt;"><span style="font-size: 10.5pt; font-family: '宋体';">查看当前数据库存储引擎，在创建时使用</span><span style="font-size: 10.5pt; font-family: '宋体';">&nbsp;</span><span style="font-size: 10.5pt; font-family: '宋体';">ENGINE=InnoDB<font face="宋体">类型。</font></span><span style="font-size: 10.5pt; font-family: '宋体';"></span></p><p class="p0" style="margin-bottom: 0pt; margin-top: 0pt;"><span style="font-size: 10.5pt; font-family: '宋体';">默认的</span><span style="font-size: 10.5pt; font-family: 'Times New Roman';">innodb_buffer_pool_size</span><span style="font-size: 10.5pt; font-family: '宋体';">=8M</span><span style="font-size: 10.5pt; font-family: '宋体';"></span></p><p class="p0" style="margin-bottom: 0pt; margin-top: 0pt;"><a href="/upload/images/25266990_1343698926Z3h3.png" target="_blank"><img src="/upload/images/25266990_1343698926Z3h3.png" height="292" border="0" width="389"/></a><br><span style="font-size: 10.5pt; font-family: '宋体';"></span></p><p class="p0" style="margin-bottom: 0pt; margin-top: 0pt;"><span style="font-size: 10.5pt; font-family: 'Times New Roman';">修改&nbsp;<font face="Times New Roman">innodb_buffer_pool_size</font></span><span style="font-size: 10.5pt; font-family: '宋体';"></span><span style="font-size: 10.5pt; font-family: 'Times New Roman';">的值：</span></p><p class="p0" style="margin-bottom: 0pt; margin-top: 0pt;"><br></p><div id="code53" class="codeText"><ol style="margin: 0pt 1px 0pt 0px; padding-left: 40px;" start="1" class="dp-css"><li>innodb_buffer_pool_size=64M</li></ol></div></div><p class="p0" style="margin-bottom: 0pt; margin-top: 0pt;"><span style="font-size: 10.5pt; font-family: 'Times New Roman';"><br></span></p><p class="p0" style="margin-bottom: 0pt; margin-top: 0pt;"><span style="font-size: 10.5pt; font-family: 'Times New Roman';">再一次重启<font face="Times New Roman">mysql</font><font face="宋体">服务器，执行表操作，成功执行完毕。</font></span><span style="font-size: 10.5pt; font-family: '宋体';"></span></p>


<pre>
referer:http://blog.chinaunix.net/uid-25266990-id-3293445.html
</pre>
