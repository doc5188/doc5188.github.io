---
layout: post
title: "squid 访问控制"
categories: 网络
tags: [bittorrent, p2p, dht]
date: 2014-10-30 23:24:59
---


<h2 style="margin: 13pt 0cm;"><span style="font-size: large;"><span style="font-family: 黑体; mso-ascii-font-family: Arial; mso-fareast-language: ZH;" lang="ZH">访问控制</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></h2>
<h3 style="margin: 13pt 0cm;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-fareast-language: ZH; mso-hansi-font-family: 'Times New Roman';" lang="ZH">访问控制元素</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></h3>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">元素是</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">Squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">的访问控制的基础。基本的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">元素语法如下：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small;"><span style="font-family: 宋体;">acl name type value1 value2 ...</span></span></span></pre>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">例如：</span><span style="color: black;" lang="EN-US"></span></span></span></p>
<p style="text-indent: 21pt;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small;"><span style="font-family: 宋体;">acl Workstations src 10.0.0.0/16</span></span></span></p>
<pre style="tab-stops: 21.75pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl Http_ports port 80 8000 8080</span></span></span></pre>
<pre><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-spacerun: yes;">&nbsp;&nbsp; </span></span></span></span></pre>
<h4 style="margin: 14pt 0cm 14.5pt;"><span style="font-size: large;"><span style="font-family: 黑体; mso-ascii-font-family: Arial; mso-fareast-language: ZH;" lang="ZH">基本的</span><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-family: Arial;">ACL</span></span><span style="font-family: 黑体; mso-ascii-font-family: Arial; mso-fareast-language: ZH;" lang="ZH">类型</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></h4>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="font-size: large;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-family: Times New Roman;">IP</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-fareast-language: ZH; mso-hansi-font-family: 'Times New Roman';" lang="ZH">地址</span></span></h5>
<p><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">使用对象：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">src,dst,myip</span></span></span></p>
<pre style="tab-stops: 21.75pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: #003300;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span></span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">在</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">里指定</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">地址时，能以子网，地址范围，域名等形式编写地址。假如你忽略掩码，</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">会自动计算相应的掩码。</span>如下<span lang="EN-US">: </span><span style="mso-fareast-language: ZH;" lang="EN-US">acl Foo src 127.0.0.1/32</span><span lang="EN-US">,</span><span style="mso-fareast-language: ZH;" lang="ZH">通过指定地址范围做到列举多个相邻子网。例如：</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="EN-US">acl Bar src 172.16.10.0-172.16.19.0/24</span><span lang="EN-US">.</span></span></span></pre>
<pre><span lang="EN-US"><span style="font-size: small; font-family: 宋体;">&nbsp;</span></span></pre>
<pre style="tab-stops: 21.75pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: red;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span></span><span style="color: red;">注意</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">使用</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">地址范围，掩码只能取一个。</span><span style="mso-fareast-language: ZH;" lang="ZH">也能在</span><span style="mso-fareast-language: ZH;" lang="EN-US">IP ACL</span><span style="mso-fareast-language: ZH;" lang="ZH">里指定主机名</span><span lang="EN-US">,</span><span style="mso-fareast-language: ZH;" lang="ZH">启动时，将主机名转换成</span><span style="mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="mso-fareast-language: ZH;" lang="ZH">地址。</span><span lang="EN-US">(</span><span style="mso-fareast-language: ZH;" lang="ZH">一旦启动，</span><span style="mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="mso-fareast-language: ZH;" lang="ZH">不会对主机名的地址发起第二次</span><span style="mso-fareast-language: ZH;" lang="EN-US">DNS</span><span style="mso-fareast-language: ZH;" lang="ZH">查询。这样，假如在</span><span style="mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="mso-fareast-language: ZH;" lang="ZH">运行中地址已改变，</span><span style="mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="mso-fareast-language: ZH;" lang="ZH">不会注意到</span><span lang="EN-US">)</span><span style="mso-fareast-language: ZH;" lang="ZH">。</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">假如主机名被解析成多个</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">地址，</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">将每一个增加到</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">里。</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">注意你也可以对主机名使用网络掩码。</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">主机名转换到</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">地址的过程会延缓</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">的启动。</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">除非绝对必要，请在</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">src,dst,</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">和</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">myip ACL</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">里避免使用主机名</span><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">。</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">以一种叫做</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">splay tree</span><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">的数据结构在内存里存储</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">地址</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">。</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">splay tree</span><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">有自我调整的特性，其中之一是在查询发生时，列表会自动纠正它自己的位置。当某个匹配元素在列表里发现时，该元素变成新的树根。在该方法中，最近参考的条目会移动到树的顶部，这减少了将来查询的时间。</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">属于同一</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">元素的所有的子网和范围不能重迭。例如，如下不被允许：</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: #003300;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">acl Foo src 1.2.3.0/24</span><span style="color: #003300;" lang="EN-US"></span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: #003300;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">acl Foo src 1.2.3.4/32</span></span></span></pre>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">它导致</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">在</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US">cache.log</span><span style="color: #003300; mso-fareast-language: ZH;" lang="ZH">里打印警告：</span><span style="color: #003300; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-fareast-language: ZH; mso-hansi-font-family: 'Times New Roman';" lang="ZH">域名</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">使用对象：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">srcdomain,dstdomain,</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">和</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">cache_host_domain</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">指令</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="ZH">当</span><span style="mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="mso-fareast-language: ZH;" lang="ZH">域名以</span><span style="mso-fareast-language: ZH;" lang="EN-US">"."</span><span style="mso-fareast-language: ZH;" lang="ZH">开头，</span><span style="mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="mso-fareast-language: ZH;" lang="ZH">将它作为通配符</span><span lang="EN-US">,</span><span style="mso-fareast-language: ZH;" lang="ZH">相反，如果</span><span style="mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="mso-fareast-language: ZH;" lang="ZH">域名不以</span><span style="mso-fareast-language: ZH;" lang="EN-US">"."</span><span style="mso-fareast-language: ZH;" lang="ZH">开头，</span><span style="mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="mso-fareast-language: ZH;" lang="ZH">使用精确的字符串比较。</span><span style="mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="mso-fareast-language: ZH;" lang="ZH">使用</span><span style="mso-fareast-language: ZH;" lang="EN-US">splay tree</span><span style="mso-fareast-language: ZH;" lang="ZH">的数据结构来存储域名</span><span style="mso-fareast-language: ZH;" lang="EN-US">ACL</span><span lang="EN-US">.</span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-fareast-language: ZH; mso-hansi-font-family: 'Times New Roman';" lang="ZH">用户名</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">使用对象：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ident,proxy_auth</span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">用户名必须被严格匹配。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">也有相关的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">对用户名使用正则表达式匹配（</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ident_regex</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">和</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">proxy_auth_regex</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">）。你可以使用单词</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">"REQUIRED"</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">作为特殊值去匹配任意用户名。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-fareast-language: ZH; mso-hansi-font-family: 'Times New Roman';" lang="ZH">正则表达式</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">使用对象：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">srcdom_regex, dstdom_regex, url_regex, urlpath_regex, browser, referer_regex, ident_regex, proxy_auth_regex, req_mime_type, rep_mime_type</span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">大量的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">使用正则表达式来匹配字符串。最常使用的正则表达式功能用以匹配字符串的开头或结尾。例如，</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">^</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">字符匹配行或字符串的开头</span><span style="color: black;" lang="EN-US">,</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">$</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">是匹配行或字符串的结尾</span><span style="color: black;" lang="EN-US">,</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">.</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">字符是匹配任意单个字符的通配符</span><span style="color: black;" lang="EN-US">,</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">对所有的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">正则表达式类</span><span style="color: black;" lang="EN-US">,</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">匹配是默认大小写敏感的。为了大小写不敏感，在</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">类型后面使用</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">-i</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">选项。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="font-size: large;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-family: Times New Roman;">TCP</span></span><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-fareast-language: ZH; mso-hansi-font-family: 'Times New Roman';" lang="ZH">端口号</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">使用对象：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">port,myport</span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">该类型是相对的</span><span style="color: black;" lang="EN-US">,</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">值是个别的端口号或端口范围。如下示例</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="FR">:</span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-ansi-language: FR;" lang="FR"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="FR">acl Foo port 123</span></span></span></pre>
<pre><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="FR"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp; </span></span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-ansi-language: FR;" lang="FR"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="FR">acl Bar port 1-1024</span></span></span></pre>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="font-size: large;"><span style="color: black; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-fareast-language: ZH; mso-hansi-font-family: 'Times New Roman';" lang="ZH">自主系统号</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="FR"></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">使用对象</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="ZH">：</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="FR">src_as,dst_as</span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="FR">Internet</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">路由器使用自主系统</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="FR">(AS)</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">号来创建路由表。基本上</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="ZH">，</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">某个</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="FR">AS</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">号指向被同一组织管理的</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="FR">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">网络范围。例如</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="ZH">，</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">我的</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="FR">ISP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">分配了如下网络块</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="ZH">：</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="FR">134.116.0.0/16, 137.41.0.0/16, 206.168.0.0/16,</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">和其他更多。在</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">Internet</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">路由表里，这些网络被公布为属于</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">AS 3404</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">。当路由器转发包时，它们典型的选择经过最少</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">AS</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">的路径。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">AS</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">基础的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">仅仅被网络</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">gurus</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">使用。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small; font-family: Times New Roman;">&nbsp;</span></span></p>
<h4 style="margin: 14pt 0cm 14.5pt;"><span style="font-size: large;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-family: Arial;">ACL</span></span><span style="font-family: 黑体; mso-ascii-font-family: Arial; mso-fareast-language: ZH;" lang="ZH">类型</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></h4>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">src</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">使用</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">地址来控制客户允许或不允许访问</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">Squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">src</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">类型指客户源</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">地址。</span><span style="color: black;" lang="EN-US"></span></span></span></p>
<p style="text-indent: 21pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small;"><span style="font-family: 宋体;">acl MyNetwork src 192.168.0.0 10.0.1.0/24 10.0.5.0/24 172.16.0.0/12</span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">dst</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">dst</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">类型指向原始服务器（目标）</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">地址。在某些情况下，能使用该类型来阻止用户访问特定</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">web</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">站点。然而，在使用</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">dst ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">时须谨慎。大部分</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">接受到的请求有原始服务器主机名</span><span lang="EN-US">.</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US"> </span><span style="color: red;" lang="EN-US"></span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: red; mso-fareast-language: ZH;" lang="ZH">请注意，为了避免延时，该尽可能的使用</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">dstdomain ACL</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">类型来代替</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">dst</span><span style="color: red;" lang="EN-US">,</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US"> dst ACL</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">存在的问题是，你试图允许或拒绝访问的原始服务器可能会改变它的</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">地址。假如你不关心这样的改变，那就不必麻烦去升级</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">squid.conf</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">。你可以在</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">acl</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">行里放上主机名，但那样会延缓启动速度。假如你的</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">需要许多主机名，你也许该预处理配置文件，将主机名转换成</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">地址。</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">myip</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">myip</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">类型指</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">Squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">地址，它被客户连接。所以该</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">元素仅仅当系统有多个</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">地址时才有用。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: red; mso-fareast-language: ZH;" lang="ZH">请注意，使用该机制你必须特别小心，阻止来自某个子网的用户连接</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">位于另一子网的</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">地址。否则，在会计和市场子网的聪明的用户，能够通过技术部子网进行连接，从而绕过你的限制。</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">dstdomain</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">使用它们去阻塞对某些站点的访问，去控制</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">如何转发请求，以及让某些响应不可缓存</span><span style="color: black;" lang="EN-US">,</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">如下两行的不同：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl A dst www.squid-cache.org</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="mso-spacerun: yes;">&nbsp;&nbsp; </span></span><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl B dstdomain www.squid-cache.org</span></span></span></pre>
<p><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">A</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">实际上是</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">地址</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black;" lang="EN-US">,</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">假如在</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">运行时</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">地址改变了，</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">会继续使用旧的地址。然而</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">dstdomain ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">以域名形式存储，并非</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">地址。当</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">检查</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL B</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">时，它对</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">URL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">的主机名部分使用字符串比较功能</span><span style="color: black;" lang="EN-US">,</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">它并不真正关心是否</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">www.squid-cache.org</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">地址改变了。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: red; mso-fareast-language: ZH;" lang="ZH">使用</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">dstdomain ACL</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">的主要问题是某些</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">URL</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">使用</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">地址代替主机名</span><span style="mso-fareast-language: ZH;" lang="ZH">。</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">srcdomain</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">srcdomain</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">要求对每个客户</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">地址进行所谓的反向</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">DNS</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">查询。使用</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">dst ACL,FQDN</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">查询会导致延时。请求会被延缓处理直到</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">FQDN</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">响应返回。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">FQDN</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">响应被缓存下来，所以</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">srcdomain</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">查询通常仅在客户首次请求时延时。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">srcdomain</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">查询有时不能工作。许多组织并没有保持他们的反向查询数据库与日更新</span><span style="color: black;" lang="EN-US">,</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">在该情形下，请求可能会延时非常长时间</span><span style="color: black;" lang="EN-US">,</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">直到</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">DNS</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">查询超时。</span><span style="color: black;" lang="EN-US"></span></span></span></p>
<pre style="tab-stops: 21.75pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: red;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span></span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">假如你使用</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">srcdomain ACL</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">，请确认你自己的</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">DNS in-addr.arpa</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">区域配置正确并且在工作中</span><span style="mso-fareast-language: ZH;" lang="ZH">。</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">port</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="ZH">使用</span><span style="mso-fareast-language: ZH;" lang="EN-US">port ACL</span><span style="mso-fareast-language: ZH;" lang="ZH">来限制对某些原始服务器端口号的访问</span><span lang="EN-US">,</span><span style="mso-fareast-language: ZH;" lang="EN-US">port ACL</span><span style="mso-fareast-language: ZH;" lang="ZH">允许你定义单独的端口或端口范围。例如：</span><span style="mso-fareast-language: ZH;" lang="EN-US">acl HTTPports port 80 8000-8010 8080</span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH; mso-ansi-language: FR;" lang="FR"><span style="font-size: large;"><span style="font-family: Times New Roman;">myport</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="FR">port ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">指向原始服务器的端口号</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="ZH">，</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="FR">myport</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">指向</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="FR">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">自己的端口号</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="ZH">，</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">用以接受客户请求。假如在</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="FR">http_port</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">指令里指定不止一个端口号</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="ZH">，</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">那么</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="FR">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">就可以在不同的端口上侦听。</span><span style="color: black; mso-fareast-language: ZH; mso-ansi-language: FR;" lang="FR"></span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">假如将</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">作为站点</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">HTTP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">加速器和用户代理服务器，可以在</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">80</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">上接受加速请求，在</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">3128</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">上接受代理请求。想让所有人访问加速器，但仅仅你自己的用户能以代理形式访问</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">可能如下：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl AccelPort myport 80</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl ProxyPort myport 3128</span><span style="color: black;" lang="EN-US"></span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl MyNet src 172.16.0.0/22</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">http_access allow AccelPort<span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span># anyone</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">http_access allow ProxyPort MyNet<span style="mso-spacerun: yes;">&nbsp;&nbsp; </span># only my users</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">http_access deny ProxyPort<span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span># deny others</span></span></span></pre>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">method</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">method ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">指</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">HTTP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">请求方法</span><span style="color: black;" lang="EN-US">,</span><span style="color: black;">如</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">:acl Uploads method PUT POST</span><span style="color: black;" lang="EN-US">.</span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">Squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">知道下列标准</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">HTTP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">方法：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">GET, POST, PUT, HEAD, CONNECT, TRACE, OPTIONS</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">和</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">DELETE</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">。另外，来自</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">WEBDAV</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">规范，</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">RFC 2518</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">的方法：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">PROPFIND, PROPPATCH, MKCOL, COPY, MOVE, LOCK, UNLOCK</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">。</span><span style="color: black;">还有</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">非标准的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">WEBDAV</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">方法</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"> BMOVE, BDELETE, BPROPFIND</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">。最后，你可以在</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">extension_methods</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">指令里配置</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">去理解其他的请求方法。</span><span style="color: black;" lang="EN-US"></span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: red; mso-fareast-language: ZH;" lang="ZH">注意</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">CONNECT</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">方法非常特殊</span><span style="mso-fareast-language: ZH;" lang="ZH">。<span style="color: red;">它是用于通过</span></span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">HTTP</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">代理来封装某种请求的方法</span><span style="mso-fareast-language: ZH;" lang="ZH">。在处理</span><span style="mso-fareast-language: ZH;" lang="EN-US">CONNECT</span><span style="mso-fareast-language: ZH;" lang="ZH">方法和远程服务器的端口号时应特别谨慎。</span>如<span style="mso-fareast-language: ZH;" lang="ZH">你不希望</span><span style="mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="mso-fareast-language: ZH;" lang="ZH">连接到某些远程服务。你该限制</span><span style="mso-fareast-language: ZH;" lang="EN-US">CONNECT</span><span style="mso-fareast-language: ZH;" lang="ZH">方法仅仅能连接到</span><span style="mso-fareast-language: ZH;" lang="EN-US">HTTPS/SSL</span><span style="mso-fareast-language: ZH;" lang="ZH">或</span><span style="mso-fareast-language: ZH;" lang="EN-US">NNTPS</span><span style="mso-fareast-language: ZH;" lang="ZH">端口（</span><span style="mso-fareast-language: ZH;" lang="EN-US">443</span><span style="mso-fareast-language: ZH;" lang="ZH">和</span><span style="mso-fareast-language: ZH;" lang="EN-US">563</span><span style="mso-fareast-language: ZH;" lang="ZH">）。默认的</span><span style="mso-fareast-language: ZH;" lang="EN-US">squid.conf</span><span style="mso-fareast-language: ZH;" lang="ZH">这样做：</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">acl CONNECT method CONNECT</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="mso-spacerun: yes;">&nbsp;&nbsp; </span></span><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">acl SSL_ports 443 563</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>h</span><span style="mso-fareast-language: ZH;" lang="EN-US">ttp_access allow CONNECT SSL_ports</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp; </span></span><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">http_access deny CONNECT</span></span></span></pre>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="ZH">在该配置里，</span><span style="mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="mso-fareast-language: ZH;" lang="ZH">仅仅允许加密请求到端口</span><span style="mso-fareast-language: ZH;" lang="EN-US">443</span><span style="mso-fareast-language: ZH;" lang="ZH">（</span><span style="mso-fareast-language: ZH;" lang="EN-US">HTTPS/SSL</span><span style="mso-fareast-language: ZH;" lang="ZH">）和</span><span style="mso-fareast-language: ZH;" lang="EN-US">563</span><span style="mso-fareast-language: ZH;" lang="ZH">（</span><span style="mso-fareast-language: ZH;" lang="EN-US">NNTPS</span><span style="mso-fareast-language: ZH;" lang="ZH">）。</span><span style="mso-fareast-language: ZH;" lang="EN-US">CONNECT</span><span style="mso-fareast-language: ZH;" lang="ZH">方法对其他端口的请求都被拒绝。</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">PURGE</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">是另一个特殊的请求方法。它是</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">Squid</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">的专有方法，它让管理员能强制删除缓存对象。</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">proto</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">该类型指</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">URI</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">访问（或传输）协议。</span><span style="mso-fareast-language: ZH;" lang="ZH">有效值：</span><span style="mso-fareast-language: ZH;" lang="EN-US">http, https (same as HTTP/TLS), ftp, gopher, urn, whois, </span><span style="mso-fareast-language: ZH;" lang="ZH">和</span><span style="mso-fareast-language: ZH;" lang="EN-US">cache_object</span><span style="mso-fareast-language: ZH;" lang="ZH">。例如拒绝所有的</span><span style="mso-fareast-language: ZH;" lang="EN-US">FTP</span><span style="mso-fareast-language: ZH;" lang="ZH">请求：</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">acl FTP proto FTP</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">http_access deny FTP</span></span></span></pre>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="EN-US">cache_object</span><span style="mso-fareast-language: ZH;" lang="ZH">机制是</span><span style="mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="mso-fareast-language: ZH;" lang="ZH">的特性。它用于访问</span><span style="mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="mso-fareast-language: ZH;" lang="ZH">的缓存管理接口。默认的</span><span style="mso-fareast-language: ZH;" lang="EN-US">squid.conf</span><span style="mso-fareast-language: ZH;" lang="ZH">文件有许多行限制缓存管理访问：</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">acl Manager proto cache_object</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="mso-spacerun: yes;">&nbsp;&nbsp; </span></span><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">acl Localhost src 127.0.0.1</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp; </span></span><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">http_access allow Manager Localhost</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp; </span></span><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">http_access deny Manager</span></span></span></pre>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="ZH">这些配置行仅允许来自本机地址的缓存管理请求，所有其他的缓存管理请求被拒绝。这意味着在</span><span style="mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="mso-fareast-language: ZH;" lang="ZH">机器上有帐号的人，能访问到潜在的敏感缓存管理信息。</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">time</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">time ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">允许你控制基于时间的访问，时间为每天中的具体时间，和每周中的每天。日期以单字母来表示，见如下表。时间以</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">24</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">小时制来表示。开始时间必须小于结束时间。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<table class="MsoNormalTable" style="mso-cellspacing: 1.5pt;" border="0" cellpadding="0">
<tbody>
<tr style="mso-yfti-irow: 0; mso-yfti-firstrow: yes;">
<td style="background-color: transparent; border: #ece9d8; padding: 0.75pt;">
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span lang="EN-US">Code</span><span style="font-size: 12pt; font-family: 宋体; mso-bidi-font-family: 宋体;" lang="EN-US"></span></span></span></p>
</td>
<td style="background-color: transparent; border: #ece9d8; padding: 0.75pt;">
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span lang="EN-US">Day</span><span style="font-size: 12pt; font-family: 宋体; mso-bidi-font-family: 宋体;" lang="EN-US"></span></span></span></p>
</td>
</tr>
<tr style="mso-yfti-irow: 1;">
<td style="background-color: transparent; border: #ece9d8; padding: 0.75pt;">
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span lang="EN-US">S</span><span style="font-size: 12pt; font-family: 宋体; mso-bidi-font-family: 宋体;" lang="EN-US"></span></span></span></p>
</td>
<td style="background-color: transparent; border: #ece9d8; padding: 0.75pt;">
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span lang="EN-US">Sunday</span><span style="font-size: 12pt; font-family: 宋体; mso-bidi-font-family: 宋体;" lang="EN-US"></span></span></span></p>
</td>
</tr>
<tr style="mso-yfti-irow: 2;">
<td style="background-color: transparent; border: #ece9d8; padding: 0.75pt;">
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span lang="EN-US">M</span><span style="font-size: 12pt; font-family: 宋体; mso-bidi-font-family: 宋体;" lang="EN-US"></span></span></span></p>
</td>
<td style="background-color: transparent; border: #ece9d8; padding: 0.75pt;">
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span lang="EN-US">Monday</span><span style="font-size: 12pt; font-family: 宋体; mso-bidi-font-family: 宋体;" lang="EN-US"></span></span></span></p>
</td>
</tr>
<tr style="mso-yfti-irow: 3;">
<td style="background-color: transparent; border: #ece9d8; padding: 0.75pt;">
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span lang="EN-US">T</span><span style="font-size: 12pt; font-family: 宋体; mso-bidi-font-family: 宋体;" lang="EN-US"></span></span></span></p>
</td>
<td style="background-color: transparent; border: #ece9d8; padding: 0.75pt;">
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span lang="EN-US">Tuesday</span><span style="font-size: 12pt; font-family: 宋体; mso-bidi-font-family: 宋体;" lang="EN-US"></span></span></span></p>
</td>
</tr>
<tr style="mso-yfti-irow: 4;">
<td style="background-color: transparent; border: #ece9d8; padding: 0.75pt;">
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span lang="EN-US">W</span><span style="font-size: 12pt; font-family: 宋体; mso-bidi-font-family: 宋体;" lang="EN-US"></span></span></span></p>
</td>
<td style="background-color: transparent; border: #ece9d8; padding: 0.75pt;">
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span lang="EN-US">Wednesday</span><span style="font-size: 12pt; font-family: 宋体; mso-bidi-font-family: 宋体;" lang="EN-US"></span></span></span></p>
</td>
</tr>
<tr style="mso-yfti-irow: 5;">
<td style="background-color: transparent; border: #ece9d8; padding: 0.75pt;">
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span lang="EN-US">H</span><span style="font-size: 12pt; font-family: 宋体; mso-bidi-font-family: 宋体;" lang="EN-US"></span></span></span></p>
</td>
<td style="background-color: transparent; border: #ece9d8; padding: 0.75pt;">
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span lang="EN-US">Thursday</span><span style="font-size: 12pt; font-family: 宋体; mso-bidi-font-family: 宋体;" lang="EN-US"></span></span></span></p>
</td>
</tr>
<tr style="mso-yfti-irow: 6;">
<td style="background-color: transparent; border: #ece9d8; padding: 0.75pt;">
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span lang="EN-US">F</span><span style="font-size: 12pt; font-family: 宋体; mso-bidi-font-family: 宋体;" lang="EN-US"></span></span></span></p>
</td>
<td style="background-color: transparent; border: #ece9d8; padding: 0.75pt;">
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span lang="EN-US">Friday</span><span style="font-size: 12pt; font-family: 宋体; mso-bidi-font-family: 宋体;" lang="EN-US"></span></span></span></p>
</td>
</tr>
<tr style="mso-yfti-irow: 7;">
<td style="background-color: transparent; border: #ece9d8; padding: 0.75pt;">
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span lang="EN-US">A</span><span style="font-size: 12pt; font-family: 宋体; mso-bidi-font-family: 宋体;" lang="EN-US"></span></span></span></p>
</td>
<td style="background-color: transparent; border: #ece9d8; padding: 0.75pt;">
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span lang="EN-US">Saturday</span><span style="font-size: 12pt; font-family: 宋体; mso-bidi-font-family: 宋体;" lang="EN-US"></span></span></span></p>
</td>
</tr>
<tr style="mso-yfti-irow: 8; mso-yfti-lastrow: yes;">
<td style="background-color: transparent; border: #ece9d8; padding: 0.75pt;">
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span lang="EN-US">D</span><span style="font-size: 12pt; font-family: 宋体; mso-bidi-font-family: 宋体;" lang="EN-US"></span></span></span></p>
</td>
<td style="background-color: transparent; border: #ece9d8; padding: 0.75pt;">
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: small;"><span style="font-family: Times New Roman;"><span lang="EN-US">All weekdays (M-F)</span><span style="font-size: 12pt; font-family: 宋体; mso-bidi-font-family: 宋体;" lang="EN-US"></span></span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small; font-family: Times New Roman;">&nbsp;</span></span></p>
<p><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">日期和时间由</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">localtime()</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">函数来产生。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">时间跨越子夜</span><span style="color: black;" lang="EN-US">,</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">你需要把它们分成两个</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">来写，或者使用否定机制来定义非忙时。例如：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl Offpeak1 20:00-23:59</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp; </span></span><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl Offpeak2 00:00-04:00</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">http_access allow Offpeak1 ...</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">http_access allow Offpeak2 ...</span></span></span></pre>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">另外，你可以这样写：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">acl</span><span style="mso-fareast-language: ZH;" lang="EN-US"> Peak</span><span style="mso-fareast-language: ZH;" lang="EN-US"> 04:00-20:00</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp; </span></span><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">http_access allow !Peak ...</span></span></span></pre>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: red; mso-fareast-language: ZH;" lang="ZH">不应该在同一个</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">time ACL</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">里放置多个日期和时间范围列表。例如，假如你输入：</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">acl Blah time M 08:00-10:00 W 09:00-11:00</span><span style="color: red;" lang="EN-US">,</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">实际能做到的是：</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">acl Blah time MW 09:00-11:00</span><span style="color: red;" lang="EN-US">,</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">解析仅仅使用最后一个时间范围。正确的写法是，将它们写进两行：</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: red;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">acl Blah time M 08:00-10:00</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: red; mso-fareast-language: ZH;" lang="EN-US"><span style="mso-spacerun: yes;">&nbsp;&nbsp; </span></span><span style="color: red;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">acl Blah time W 09:00-11:00</span></span></span></pre>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">ident</span></span></span></h5>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt 18pt; text-align: left; mso-pagination: widow-orphan; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto;" align="left"><span style="font-size: 12pt; color: black; font-family: 宋体; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-fareast-language: ZH;" lang="EN-US">ident ACL</span><span style="font-size: 12pt; color: black; font-family: 宋体; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-fareast-language: ZH;" lang="ZH">匹配被</span><span style="font-size: 12pt; color: black; font-family: 宋体; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-fareast-language: ZH;" lang="EN-US">ident</span><span style="font-size: 12pt; color: black; font-family: 宋体; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-fareast-language: ZH;" lang="ZH">协议返回的用户名。</span><span style="font-size: 12pt; color: black; font-family: 宋体; mso-font-kerning: 0pt; mso-bidi-font-family: 宋体; mso-fareast-language: ZH;" lang="EN-US"> </span></p>
<p style="text-indent: 18pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ident ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">可以对你的用户请求造成延时</span><span style="color: black;" lang="EN-US">,</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">推荐仅仅在本地局域网中，并且大部分客户工作站运行</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ident</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">服务时，才使用</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ident ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p style="text-indent: 18pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: red; mso-fareast-language: ZH;" lang="ZH">注意</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">ident</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">协议</span><span style="color: red;">不是</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">很安全</span><span style="color: red;" lang="EN-US">;</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">也有个对客户端执行懒惰</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">ident</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">查询。在该情形下，在等待</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">ident</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">查询时，请求不会延时</span><span style="mso-fareast-language: ZH;" lang="ZH">。</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">proxy_auth</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">支持</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">HTTP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">代理验证功能。使用代理验证，客户的包括头部的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">http</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">请求包含了验证信用选项。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">解密信用选项，并调用外部验证程序以发现该信用选项是否有效。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">当前支持三种技术以接受用户验证：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">HTTP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">基本协议，数字认证协议，和</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">NTLM</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">。基本认证是非常不安全的技术</span><span style="color: black;" lang="EN-US">,</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">以明文同时发送。数字认证更安全，但也更复杂。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">NTLM</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">也比基本认证更安全</span><span style="color: black;" lang="EN-US">,</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">然而它是</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">Microsoft</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">发展的专有协议</span><span style="mso-fareast-language: ZH;" lang="ZH">。</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">为了使用代理验证，你必须配置</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">使用大量的外部辅助程序</span><span style="color: black;" lang="EN-US">,</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">auth_param</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">指令控制对所有辅助程序的配置。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre style="tab-stops: 21.75pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">auth_param</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">指令和</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">proxy_auth ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">是少数在配置文件里顺序重要的实例。你必须在</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">proxy_auth ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">之前定义至少一个验证辅助程序（使用</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">auth_param</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">）。</span><span style="color: black;" lang="EN-US"></span></span></span></pre>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: red; mso-fareast-language: ZH;" lang="ZH">代理验证不支持</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">HTTP</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">拦截，因为用户代理不知道它在与代理服务器，而非原始服务器通信</span><span style="mso-fareast-language: ZH;" lang="ZH">。</span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">src_as</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">该类型检查客户源</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">地址所属的具体</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">AS</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">号</span><span style="mso-fareast-language: ZH;" lang="ZH">。</span>例如<span style="mso-fareast-language: ZH;" lang="ZH">，我们虚构某</span><span style="mso-fareast-language: ZH;" lang="EN-US">ISP</span><span style="mso-fareast-language: ZH;" lang="ZH">使用</span><span style="mso-fareast-language: ZH;" lang="EN-US">AS 64222</span><span style="mso-fareast-language: ZH;" lang="ZH">并且通告使用</span><span style="mso-fareast-language: ZH;" lang="EN-US">10.0.0</span><span style="mso-fareast-language: ZH;" lang="EN-US">.0/8,172.16.0.0/12,192.168.0.0/16</span><span style="mso-fareast-language: ZH;" lang="ZH">网络。你可以编写这样的</span><span style="mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="mso-fareast-language: ZH;" lang="ZH">，它允许来自该</span><span style="mso-fareast-language: ZH;" lang="EN-US">ISP</span><span style="mso-fareast-language: ZH;" lang="ZH">地址空间的任何主机请求：</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">acl TheISP src 10.0.0.0/8</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp; </span></span><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">acl TheISP src 172.16.0.0/12</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp; </span></span><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">acl TheISP src 192.168.0.0/16</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp; </span></span><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">http_access allow TheISP</span></span></span></pre>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="ZH">当然，可以这样写：</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">acl TheISP src_as 64222</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="mso-spacerun: yes;">&nbsp;&nbsp; </span></span><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">http_access allow TheISP</span></span></span></pre>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">dst_as</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">dst_as ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">经常与</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">cache_peer_access</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">指令一起使用。在该方法中，</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">使用与</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">路由一致的方式转发</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">cache</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">丢失。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">snmp_community</span></span></span></h5>
<p style="margin-left: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: blue; mso-fareast-language: ZH;" lang="EN-US">snmp_community ACL</span><span style="color: blue; mso-fareast-language: ZH;" lang="ZH">对</span><span style="color: blue; mso-fareast-language: ZH;" lang="EN-US">SNMP</span><span style="color: blue; mso-fareast-language: ZH;" lang="ZH">查询才有意义，后者被</span><span style="color: blue; mso-fareast-language: ZH;" lang="EN-US">snmp_access</span><span style="color: blue; mso-fareast-language: ZH;" lang="ZH">指令控制</span><span style="mso-fareast-language: ZH;" lang="ZH">。例如：</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">acl OurCommunityName snmp_community hIgHsEcUrItY</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp; </span></span><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">acl All src 0/0</span></span></span></pre>
<pre><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>snmp_access allow OurCommunityName</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="mso-fareast-language: ZH;" lang="EN-US">snmp_access deny All</span></span></span></pre>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="ZH">在该情况中，假如</span><span style="mso-fareast-language: ZH;" lang="EN-US">community</span><span style="mso-fareast-language: ZH;" lang="ZH">名字设置为</span><span style="mso-fareast-language: ZH;" lang="EN-US">hIgHsEcUrItY</span><span style="mso-fareast-language: ZH;" lang="ZH">，</span><span style="mso-fareast-language: ZH;" lang="EN-US">SNMP</span><span style="mso-fareast-language: ZH;" lang="ZH">查询才被允许。</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">maxconn</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">maxconn ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">指来自客户</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">地址的大量同时连接。某些</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">管理员发现这是个有用的方法，用以阻止用户滥用代理或者消耗过多资源。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">arp</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">arp ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">用于检测</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">cache</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">客户端的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">MAC</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">地址（以太网卡的物理地址）。该特性使用非移植性代码。运行</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">./configure</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">时增加</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">--enable-arp-acl</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">选项，就可以激活该功能。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">arp ACL</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">有另一个重要限制。客户主机和</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">在同一子网，它才能工作。在</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">和你的用户之间有路由器存在，你可能不能使用</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US">arp ACL</span><span style="color: red; mso-fareast-language: ZH;" lang="ZH">。</span><span style="color: red; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">src<span style="color: black;">dom_regex</span></span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">srcdom_regex ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">允许你使用正则表达式匹配客户域名。限制是：某些客户地址不能反向解析到域名。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">dstdom_regex</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">dstdom_regex ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">也与</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">dstdomain</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">相似。下面的例子匹配以</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">www</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">开头的主机名：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl WebSite dstdom_regex -i ^www/.</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">如下是另一个有用的正则表达式，用以匹配在</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">URL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">主机名里出现的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">地址：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl IPaddr dstdom_regex [0-9]$</span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">url_regex</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">url_regex ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">用于匹配请求</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">URL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">的任何部分，包括传输协议和原始服务器主机名。例如，如下</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">匹配从</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">FTP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">服务器的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">MP3</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">文件请求：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl FTPMP3 url_regex -i ^ftp://.*/.mp3$</span></span></span></pre>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">urlpath_regex</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">urlpath_regex</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">与</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">url_regex</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">非常相似，不过传输协议和主机名不包含在匹配条件里。这让某些类型的检测非常容易。例如，假设你必须拒绝</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">URL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">里的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">"sex"</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">，但仍允许在主机名里含有</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">"sex"</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">的请求，那么这样做：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl Sex urlpath_regex sex</span></span></span></pre>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">browser</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">browser ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">对</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">user-agent</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">头执行正则表达式匹配。例如，拒绝不是来自</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">Mozilla</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">浏览器的请求，可以这样写：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl Mozilla browser Mozilla</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp; </span></span><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">http_access deny !Mozilla</span></span></span></pre>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">req_mime_type</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">req_mime_type ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">指客户</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">HTTP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">请求里的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">Content-Type</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">头部。该类型头部通常仅仅出现在请求消息主体里。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">req_mime_type ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">值是正则表达式。你可以这样编写</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">去捕获音频文件类型：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl AuidoFileUploads req_mime_type -i ^audio/</span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">rep_mime_type</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">该类型</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">指原始服务器的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">HTTP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">响应里的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">Content-Type</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">头部。它仅在使用</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">http_reply_access</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">规则时才有用。假如你想使用</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">阻塞</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">Java</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">代码，你可以这样写：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl JavaDownload rep_mime_type application/x-java</span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="mso-spacerun: yes;">&nbsp;&nbsp;&nbsp; </span></span><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">http_reply_access deny JavaDownload</span></span></span></pre>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">ident_regex</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ident_regex</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">允许你使用正则表达式，代替严格的字符串匹配，这些匹配是对</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ident</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">协议返回的用户名进行。例如，如下</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">匹配包含数字的用户名：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl NumberInName ident_regex [0-9]</span></span></span></p>
<h5 style="margin: 14pt 0cm 14.5pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: large;"><span style="font-family: Times New Roman;">proxy_auth_regex</span></span></span></h5>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">该</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">允许对代理认证用户名使用正则表达式。例如，如下</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">匹配</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">admin,administrator</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">和</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">administrators:</span><span style="color: black;" lang="EN-US"> </span></span></span></p>
<p style="text-indent: 21pt;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small;"><span style="font-family: 宋体;">acl Admins proxy_auth_regex -i ^admin</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small; font-family: Times New Roman;">&nbsp;</span></span></p>
<h4 style="margin: 14pt 0cm 14.5pt;"><span style="font-size: large;"><span style="font-family: 黑体; mso-ascii-font-family: Arial; mso-fareast-language: ZH;" lang="ZH">外部</span><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-family: Arial;">ACL</span></span></span></h4>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">外部</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">可以指示</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">发送某些信息片断到外部进程，然后外部的辅助程序告诉</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">，数据匹配或不匹配。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">external_acl_type</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">指令定义新的外部</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">类型。通用语法：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre style="tab-stops: 21.75pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">external_acl_type type-name [options] format helper-command</span></span></span></pre>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">type-name</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">是用户定义的字串。</span><span style="color: black;" lang="EN-US"></span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">Squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">当前支持如下选项</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">(options)</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ttl=n</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">用以缓存匹配值的时间长短。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">negative_ttl=n</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">用以缓存不匹配值的时间长短。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">concurrency=n</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">衍生的辅助程序的数量。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">cache=n</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">缓存结果的最大数量</span><span style="color: green; mso-fareast-language: ZH;" lang="ZH">。</span><span style="color: green;" lang="EN-US"></span></span></span></pre>
<pre><span style="color: green;" lang="EN-US"><span style="font-size: small; font-family: 宋体;">&nbsp;</span></span></pre>
<pre style="text-indent: 18pt; mso-char-indent-count: 1.5;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">格式是以</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">%</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">字符开始的一个或多个关键字。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">当前支持如下格式：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">%LOGIN</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">从代理验证信用选项里获取的用户名。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">%IDENT</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">从</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">RFC 1413 ident</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">获取的用户名。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">%SRC</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">客户端</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">地址。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">%DST</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">原始服务器</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">地址。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">%PROTO</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">传输协议（例如</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">HTTP,FTP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">等）</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">%PORT</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">原始服务器的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">TCP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">端口。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">%METHOD</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">HTTP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">请求方法。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">%{Header}</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">HTTP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">请求头部的值；</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">%{Hdr:member}</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">选择某些数量的基于列表的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">HTTP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">头部</span><span style="color: black;" lang="EN-US"></span></span></span></pre>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">可以在这里包含命令参数。例如，整条命令可能类似如此：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre style="margin-left: 42pt; mso-para-margin-left: 4.0gd;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;"> </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">/usr/local/squid/libexec/my-acl-prog.pl -X -5 /usr/local/squid/etc/datafile</span></span></span></pre>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">将这些放在一个长行里。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">不支持如下通过反斜杠分隔长行的技术，所以请记住所有这些必须放在单行里</span><span style="color: black;" lang="EN-US"></span></span></span></p>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">编写引用它的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">行。这相对容易，语法如下：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl acl-name external type-name [args ...]</span></span></span></pre>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">如下是个简单示例：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black;" lang="EN-US"><span style="mso-tab-count: 1;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl MyAcl external MyAclType</span></span></span></pre>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">接受在</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">type-name</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">后面的任意数量的参数。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small; font-family: Times New Roman;">&nbsp;</span></span></p>
<h4 style="margin: 14pt 0cm 14.5pt;"><span style="font-size: large;"><span style="font-family: 黑体; mso-ascii-font-family: Arial; mso-fareast-language: ZH;" lang="ZH">处理长</span><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-family: Arial;">ACL</span></span><span style="font-family: 黑体; mso-ascii-font-family: Arial; mso-fareast-language: ZH;" lang="ZH">列表</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></h4>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="mso-fareast-language: ZH;" lang="ZH">从外部文件里包含</span><span style="mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="mso-fareast-language: ZH;" lang="ZH">列表。语法：</span><span style="mso-fareast-language: ZH;" lang="EN-US">acl name "filename"</span></span></span></p>
<pre style="margin-left: 10.5pt; text-indent: 12pt; mso-char-indent-count: 1.0; mso-para-margin-left: 1.0gd;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">这里的双引号指示</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">打开</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">filename</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">，并且将它里面的内容分配给</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">文件可以包含以</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">#</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">开头的注释。注意在该文件里的每个</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">地址必须是一个单独的行。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">acl</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">行里的任何地方，以空格来分隔值，新行是包含</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">值的文件的分界。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small; font-family: Times New Roman;">&nbsp;</span></span></p>
<h4 style="margin: 14pt 0cm 14.5pt;"><span style="font-size: large;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-family: Arial;">Squid</span></span><span style="font-family: 黑体; mso-ascii-font-family: Arial; mso-fareast-language: ZH;" lang="ZH">如何匹配访问控制元素</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></h4>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">在检查</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">元素值时使用</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">OR</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">逻辑。当</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">找到第一个值匹配时，它停止搜索。这意味着把最可能匹配的值放在列表开头处，能减少延时。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small; font-family: Times New Roman;">&nbsp;</span></span></p>
<h3 style="margin: 13pt 0cm;"><span style="font-size: large;"><span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-fareast-language: ZH; mso-hansi-font-family: 'Times New Roman';" lang="ZH">访问控制规则</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></h3>
<p><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">有大量其他的访问控制列表：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">http_access</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">它决定哪些客户</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">HTTP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">请求被允许，和哪些被拒绝。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">http_reply_access</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">基于响应内容类型来允许或拒绝请求。</span><span style="color: black;" lang="EN-US"></span></span></span></pre>
<pre><span style="color: black;" lang="EN-US"><span style="font-size: small; font-family: 宋体;">&nbsp;</span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">icp_access</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">被配置来服务</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ICP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">响应，那么该使用</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">icp_access</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">列表。</span><span style="color: black;" lang="EN-US"></span></span></span></pre>
<pre><span style="color: black;" lang="EN-US"><span style="font-size: small; font-family: 宋体;">&nbsp;</span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">no_cache</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">使用</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">no_cache</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">访问列表来指示</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">，它不必存储某些响应（在磁盘或内存里）。</span><span style="color: black;" lang="EN-US"></span></span></span></pre>
<pre><span style="color: black;" lang="EN-US"><span style="font-size: small; font-family: 宋体;">&nbsp;</span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">miss_access</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">主要用于</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">的邻居</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">cache</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">。它决定</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">怎样处理</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">cache</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">丢失的请求。如果</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">使用集群技术，那么该功能必需。</span><span style="color: black;" lang="EN-US"></span></span></span></pre>
<pre><span style="color: black;" lang="EN-US"><span style="font-size: small; font-family: 宋体;">&nbsp;</span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">redirector_access</span><span style="color: black;" lang="EN-US">:</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">该访问列表决定哪个请求被发送到重定向进程。可以使用</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">redirector_access</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">列表来阻止某些请求被重写。</span><span style="color: black;" lang="EN-US"></span></span></span></pre>
<pre><span style="color: black;" lang="EN-US"><span style="font-size: small; font-family: 宋体;">&nbsp;</span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ident_lookup_access</span><span style="color: black;" lang="EN-US">: </span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ident_lookup_access</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">列表与</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">redirector_access</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">类似。它允许你对某些请求执行懒惰</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ident</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">查询。</span><span style="color: black;" lang="EN-US"></span></span></span></pre>
<pre><span style="color: black;" lang="EN-US"><span style="font-size: small; font-family: 宋体;">&nbsp;</span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">always_direct</span><span style="color: black;" lang="EN-US">: </span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">该访问列表影响</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">怎样处理与邻居</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">cache</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">转发</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">cache</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">丢失。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">never_direct</span><span style="color: black;" lang="EN-US">: </span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">never_direct</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">与</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">always_direct</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">相反。匹配该列表的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">cache</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">丢失请求必须发送到邻居</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">cache</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">。</span><span style="color: black;" lang="EN-US"></span></span></span></pre>
<pre><span style="color: black;" lang="EN-US"><span style="font-size: small; font-family: 宋体;">&nbsp;</span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">snmp_access</span><span style="color: black;" lang="EN-US">: </span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">该访问列表应用到发送给</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">SNMP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">端口的查询。</span><span style="color: black;" lang="EN-US"></span></span></span></pre>
<pre><span style="color: black;" lang="EN-US"><span style="font-size: small; font-family: 宋体;">&nbsp;</span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">broken_posts</span><span style="color: black;" lang="EN-US">: </span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">该访问列表影响</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">处理某些</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">POST</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">请求的方法。</span><span style="color: black;" lang="EN-US"></span></span></span></pre>
<pre><span style="color: black;" lang="EN-US"><span style="font-size: small; font-family: 宋体;">&nbsp;</span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">cache_peer_access</span><span style="color: black;" lang="EN-US">: </span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">该访问列表控制发送到邻居</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">cache</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">HTTP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">请求和</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ICP/HTCP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">查询。</span><span style="color: black;" lang="EN-US"></span></span></span></pre>
<pre><span style="color: black;" lang="EN-US"><span style="font-size: small; font-family: 宋体;">&nbsp;</span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">reply_body_max_size</span><span style="color: black;" lang="EN-US">: </span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">该访问列表限制对</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">HTTP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">响应主体的最大可接受</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">size</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">。</span><span style="color: black;" lang="EN-US"></span></span></span></pre>
<pre><span style="color: black;" lang="EN-US"><span style="font-size: small; font-family: 宋体;">&nbsp;</span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">delay_access</span><span style="color: black;" lang="EN-US">: </span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">该访问规则列表控制是否延时池被应用到某个请求的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">cache</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">丢失响应。</span><span style="color: black;" lang="EN-US"></span></span></span></pre>
<pre><span style="color: black;" lang="EN-US"><span style="font-size: small; font-family: 宋体;">&nbsp;</span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">tcp_outgoing_address</span><span style="color: black;" lang="EN-US">: </span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">该访问列表绑定服务端</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">TCP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">连接到指定的本地</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">地址。</span><span style="color: black;" lang="EN-US"></span></span></span></pre>
<pre><span style="color: black;" lang="EN-US"><span style="font-size: small; font-family: 宋体;">&nbsp;</span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">tcp_outgoing_tos</span><span style="color: black;" lang="EN-US">: </span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">该访问列表能设置到原始服务器和邻居</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">cache</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">TCP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">连接的不同</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">TOS/Diffserv</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">值。</span><span style="color: black;" lang="EN-US"></span></span></span></pre>
<pre><span style="color: black;" lang="EN-US"><span style="font-size: small; font-family: 宋体;">&nbsp;</span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">header_access</span><span style="color: black;" lang="EN-US">: </span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">使用该指令，你能配置</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">从它转发的请求里删除某些</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">HTTP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">头部。</span><span style="color: black;" lang="EN-US"></span></span></span></pre>
<pre><span style="color: black;" lang="EN-US"><span style="font-size: small; font-family: 宋体;">&nbsp;</span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">header_replace</span><span style="color: black;" lang="EN-US">: </span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">该指令允许你替换，而不是删除，</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">HTTP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">头部的内容。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><br style="mso-special-character: line-break;" /><br style="mso-special-character: line-break;" /></span></p>
<h4 style="margin: 14pt 0cm 14.5pt;"><span style="font-size: large;"><span style="font-family: 黑体; mso-ascii-font-family: Arial; mso-fareast-language: ZH;" lang="ZH">访问规则语法</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></h4>
<p><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">访问控制规则的语法如下：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small;"><span style="font-family: 宋体;">access_list allow|deny [!]ACLname ...</span></span></span></pre>
<p><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">将最常用的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">放在列表的开始位置，可以减少</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">CPU</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">负载。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">请谨慎的编写</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">always_direct,never_direct,</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">和</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">no_cache</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">规则。在</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">always_direct</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">中，</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">allow</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">规则意味着匹配的请求直接转发到原始服务器。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">always_direct deny</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">规则意味着匹配的请求不强迫发送到原始服务器，但假如邻居</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">cache</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">不可到达，那可能还是会这么做。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">no_cache</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">规则也有点麻烦。这里，你必须对不必被</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">cache</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">的请求使用</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">deny</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><br style="mso-special-character: line-break;" /><br style="mso-special-character: line-break;" /></span></p>
<h4 style="margin: 14pt 0cm 14.5pt;"><span style="font-size: large;"><span style="font-family: 黑体; mso-ascii-font-family: Arial; mso-fareast-language: ZH;" lang="ZH">如何匹配访问规则</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></h4>
<p style="text-indent: 21pt;"><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">在搜索</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">元素时使用的&ldquo;或&rdquo;逻辑。访问规则恰好相反</span><span style="color: black;" lang="EN-US">,</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">使用&ldquo;与&rdquo;逻辑。如下示例：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small;"><span style="font-family: 宋体;">access_list allow ACL1 ACL2 ACL3</span></span></span></pre>
<p><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">对该匹配规则来说，请求必须匹配</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL1,ACL2,ACL3</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">中的任何一个。</span><span style="color: black;" lang="EN-US"></span></span></span></p>
<p><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">对某个规则来说，将最少匹配的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">放在首位，能使效率最佳。考虑如下示例：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">假如最后的规则是</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">deny</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">规则，默认动作是允许请求。在访问列表的最后加上一条，明确允许或拒绝所有请求，是好的实际做法。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<p><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">src 0/0 ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">表示匹配每一个和任意类型的请求。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><br style="mso-special-character: line-break;" /><br style="mso-special-character: line-break;" /></span></p>
<h4 style="margin: 14pt 0cm 14.5pt;"><span style="font-size: large;"><span style="font-family: 黑体; mso-ascii-font-family: Arial; mso-fareast-language: ZH;" lang="ZH">访问列表风格</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></h4>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">该将更具体的和受限制的访问列表放在首位。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<pre><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">无论何时，你编写了一个带两个或更多</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">元素的规则，建议你在其后紧跟一条相反的，更广泛的规则。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></pre>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small; font-family: Times New Roman;">&nbsp;</span></span></p>
<h4 style="margin: 14pt 0cm 14.5pt;"><span style="font-size: large;"><span style="font-family: 黑体; mso-ascii-font-family: Arial; mso-fareast-language: ZH;" lang="ZH">延时检查</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></h4>
<p><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">当</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">遇到某个</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">不能被检查时，它延迟决定并且发布对必要信息的查询（</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">IP</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">地址，域名，用户名等）。当信息可用时，</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">squid</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">再次在列表的开头位置检查这些规则。它不会从前次检查剩下的位置继续。假如可能，你应该将这些最可能被延时的</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US">ACL</span><span style="color: black; mso-fareast-language: ZH;" lang="ZH">放在规则的顶部，以避免不必要的，重复的检查。</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small; font-family: Times New Roman;">&nbsp;</span></span></p>
<h4 style="margin: 14pt 0cm 14.5pt;"><span style="font-size: large;"><span style="font-family: 黑体; mso-ascii-font-family: Arial; mso-fareast-language: ZH;" lang="ZH">减缓和加速规则检查</span><span style="mso-fareast-language: ZH;" lang="EN-US"></span></span></h4>
<p><span style="font-size: small;"><span style="font-family: 宋体;"><span style="color: black; mso-fareast-language: ZH;" lang="ZH">下列访问规则被快速检查：</span><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"></span></span></span></p>
<pre style="text-justify: inter-ideograph; margin-left: 21pt; text-align: justify; tab-stops: 21.75pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; mso-para-margin-left: 2.0gd;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small;"><span style="font-family: 宋体;">header_access</span></span></span></pre>
<pre style="text-justify: inter-ideograph; margin-left: 21pt; text-align: justify; tab-stops: 21.75pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt; mso-para-margin-left: 2.0gd;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small;"><span style="font-family: 宋体;">reply_body_max_size</span></span></span></pre>
<pre style="text-justify: inter-ideograph; margin-left: 21pt; text-align: justify; mso-para-margin-left: 2.0gd;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small;"><span style="font-family: 宋体;">reply_access</span></span></span></pre>
<pre style="text-justify: inter-ideograph; margin-left: 21pt; text-align: justify; mso-para-margin-left: 2.0gd;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small;"><span style="font-family: 宋体;">ident_lookup</span></span></span></pre>
<pre style="text-justify: inter-ideograph; margin-left: 21pt; text-align: justify; mso-para-margin-left: 2.0gd;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small;"><span style="font-family: 宋体;">delay_access</span></span></span></pre>
<pre style="text-justify: inter-ideograph; margin-left: 21pt; text-align: justify; mso-para-margin-left: 2.0gd;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small;"><span style="font-family: 宋体;">miss_access</span></span></span></pre>
<pre style="text-justify: inter-ideograph; margin-left: 21pt; text-align: justify; mso-para-margin-left: 2.0gd;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small;"><span style="font-family: 宋体;">broken_posts</span></span></span></pre>
<pre style="text-justify: inter-ideograph; margin-left: 21pt; text-align: justify; mso-para-margin-left: 2.0gd;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small;"><span style="font-family: 宋体;">icp_access</span></span></span></pre>
<pre style="text-justify: inter-ideograph; margin-left: 21pt; text-align: justify; mso-para-margin-left: 2.0gd;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small;"><span style="font-family: 宋体;">cache_peer_access</span></span></span></pre>
<pre style="text-justify: inter-ideograph; margin-left: 21pt; text-align: justify; mso-para-margin-left: 2.0gd;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small;"><span style="font-family: 宋体;">redirector_access</span></span></span></pre>
<pre style="text-justify: inter-ideograph; margin-left: 21pt; text-align: justify; mso-para-margin-left: 2.0gd;"><span style="color: black; mso-fareast-language: ZH;" lang="EN-US"><span style="font-size: small;"><span style="font-family: 宋体;">snmp_access</span></span></span></pre>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-family: &quot;FrutigerNext LT Regular&quot;; mso-bidi-font-size: 10.5pt;" lang="EN-US"><span style="font-size: small; font-family: Times New Roman;">&nbsp;</span></span></p>

