---
layout: post
title: "linux 下C调用Python 模块"
categories: python
tags: [c调python]
date: 2015-01-08 15:15:56
---

<span class="Apple-tab-span" style="white-space: pre;">	</span><font size="4"><b>最近做一个移植项目， 用到C调用Python， 在网上搜了好多资料，但是发现按照上面介绍的一步一步来， 根本行不通，最后还是根据系统报出的错误，进行调试才成功， 所以感觉很有必要做下记录。</b></font><div><font size="4"><b>&nbsp; &nbsp; &nbsp; 下面以main.c 调用 hellWorld.py 函数为例进行说明。</b></font></div><div><font size="4"><b>&nbsp; &nbsp; &nbsp; &nbsp;helloWorld.py 的内容很简单只是定义了hello函数然后输出“Hello World”</b></font></div><div><font size="4"><br></font></div><div><span class="Apple-tab-span" style="white-space: pre;">	</span><a href="/upload/images/22920230_1353584723f9EH.png" target="_blank"><img src="/upload/images/22920230_1353584723f9EH.png" onload="imgResize(this, 650);" ;="" height="78" border="0" width="510"></a></div><div><span class="Apple-tab-span" style="white-space: pre;">	</span></div><div><span class="Apple-tab-span" style="white-space: pre;">	</span><font size="4"><b>main.c 函数也比较简单，主要是初始化python，以及导入python的模块等</b></font></div><div><font size="4"><br></font></div><div><span class="Apple-tab-span" style="white-space: pre;">	</span><a href="/upload/images/22920230_13535871359Mde.png" target="_blank"><img src="/upload/images/22920230_13535871359Mde.png" onload="imgResize(this, 650);" ;="" height="315.09000000000003" border="0" width="601.83"></a></div><div><span class="Apple-tab-span" style="white-space: pre;">	</span><font size="4"><b>里面的Python_Initialize()主要是初始化python解释器。</b></font></div><div><font size="4"><b>&nbsp; &nbsp; &nbsp; Py_SimpleString("import sys")相当于在python中的import sys语句。</b></font></div><div><font size="4"><b>&nbsp; &nbsp; &nbsp; Py_SimpleString("sys.path.append('./')")是将搜索路径设置为当前目录。</b></font></div><div><font size="4"><b>&nbsp; &nbsp; &nbsp; Py_ImportModule("helloWorld")是利用导入文件函数将helloWorld.py函数导入。</b></font></div><div><font size="4"><b>&nbsp; &nbsp; &nbsp; PyObject_GetAttrString(pModule, "hello")是在pyton引用模块helloWorld.py中查找hello函数。</b></font></div><div><span class="Apple-tab-span" style="white-space: pre;">	</span><font size="4"><b>接着调用PyEval_CallObject(pFunc, NULL)调用hello函数。</b></font></div><div><font size="4"><b>&nbsp; &nbsp; &nbsp; 最后是清理python环境释放资源。</b></font></div><div><font size="4"><b><br></b></font></div><div><font size="4"><b>&nbsp; &nbsp; &nbsp;在写好了helloWorld.py和main.c函数后就得写Makefile函数了，Makefile函数代码如下：</b></font></div><div><font size="4"><b>&nbsp; &nbsp; &nbsp;</b></font><a href="/upload/images/22920230_13535907092f52.png" target="_blank"><img src="/upload/images/22920230_13535907092f52.png" onload="imgResize(this, 650);" ;="" height="59.85" border="0" width="604.8"></a></div><div><font size="4"><b>&nbsp; &nbsp; &nbsp;</b></font></div><div>&nbsp; &nbsp; &nbsp;<font size="4"><b> make后生成main，./main运行结果：</b></font></div><div><font size="4"><b>&nbsp; &nbsp;&nbsp;</b></font><a href="/upload/images/22920230_13535910127bz9.png" target="_blank"><img src="/upload/images/22920230_13535910127bz9.png" onload="imgResize(this, 650);" ;="" height="93.8" border="0" width="601.3"></a></div><div>&nbsp; &nbsp;&nbsp;</div><div>&nbsp; &nbsp; &nbsp; <font size="4"><b>结果打印出了helloWorld.py中的数据， 说明C调用Python成功！</b></font></div><div><br></div>


<pre>
referer:http://blog.chinaunix.net/uid-22920230-id-3418169.html
</pre>
