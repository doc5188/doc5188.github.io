---
layout: post
title: "MySQL中MyISAM引擎与InnoDB引擎性能简单测试"
categories: mysql
tags: [mysql, mysql性能测试]
date: 2014-12-17 09:59:33
---

<br /><font size="3"><span style="color: rgb(153, 51, 0); font-weight: bold;">MySQL中MyISAM引擎与InnoDB引擎性能简单测试</span></font><br /><br /><br /><span style="font-weight: bold;">[硬件配置]</span><br />CPU : AMD2500+ (1.8G)<br />内存: 1G/现代<br />硬盘: 80G/IDE<br /><br /><span style="font-weight: bold;">[软件配置]</span><br />OS : Windows XP SP2<br />SE : PHP5.2.1<br />DB : MySQL5.0.37<br />Web: IIS6<br /><br /><br /><span style="font-weight: bold;">[MySQL表结构]</span><br />
<div style="border: 0.5pt solid windowtext; padding: 4px 5.4pt; background: rgb(230, 230, 230) none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; width: 95%;">
<div><span style="color: rgb(0, 0, 0);"><br /></span><span style="color: rgb(0, 0, 255);">CREATE</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);">&nbsp;`myisam`&nbsp;(<br />&nbsp;&nbsp;`id`&nbsp;</span><span style="color: rgb(0, 0, 0); font-weight: bold;">int</span><span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 0, 0); font-weight: bold;">11</span><span style="color: rgb(0, 0, 0);">)&nbsp;</span><span style="color: rgb(128, 128, 128);">NOT</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">&nbsp;auto_increment,<br />&nbsp;&nbsp;`name`&nbsp;</span><span style="color: rgb(0, 0, 0); font-weight: bold;">varchar</span><span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 0, 0); font-weight: bold;">100</span><span style="color: rgb(0, 0, 0);">)&nbsp;</span><span style="color: rgb(0, 0, 255);">default</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">,<br />&nbsp;&nbsp;`content`&nbsp;</span><span style="color: rgb(0, 0, 0); font-weight: bold;">text</span><span style="color: rgb(0, 0, 0);">,<br />&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">PRIMARY</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 255);">KEY</span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;(`id`)<br />)&nbsp;ENGINE</span><span style="color: rgb(128, 128, 128);">=</span><span style="color: rgb(0, 0, 0);">MyISAM&nbsp;</span><span style="color: rgb(0, 0, 255);">DEFAULT</span><span style="color: rgb(0, 0, 0);">&nbsp;CHARSET</span><span style="color: rgb(128, 128, 128);">=</span><span style="color: rgb(0, 0, 0);">gbk;<br /><br /></span><span style="color: rgb(0, 0, 255);">CREATE</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 255);">TABLE</span><span style="color: rgb(0, 0, 0);">&nbsp;`innodb`&nbsp;(<br />&nbsp;&nbsp;`id`&nbsp;</span><span style="color: rgb(0, 0, 0); font-weight: bold;">int</span><span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 0, 0); font-weight: bold;">11</span><span style="color: rgb(0, 0, 0);">)&nbsp;</span><span style="color: rgb(128, 128, 128);">NOT</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">&nbsp;auto_increment,<br />&nbsp;&nbsp;`name`&nbsp;</span><span style="color: rgb(0, 0, 0); font-weight: bold;">varchar</span><span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(128, 0, 0); font-weight: bold;">100</span><span style="color: rgb(0, 0, 0);">)&nbsp;</span><span style="color: rgb(0, 0, 255);">default</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 255);">NULL</span><span style="color: rgb(0, 0, 0);">,<br />&nbsp;&nbsp;`content`&nbsp;</span><span style="color: rgb(0, 0, 0); font-weight: bold;">text</span><span style="color: rgb(0, 0, 0);">,<br />&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">PRIMARY</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 255);">KEY</span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;(`id`)<br />)&nbsp;ENGINE</span><span style="color: rgb(128, 128, 128);">=</span><span style="color: rgb(0, 0, 0);">InnoDB&nbsp;</span><span style="color: rgb(0, 0, 255);">DEFAULT</span><span style="color: rgb(0, 0, 0);">&nbsp;CHARSET</span><span style="color: rgb(128, 128, 128);">=</span><span style="color: rgb(0, 0, 0);">gbk;</span></div>
</div>
<br /><br /><span style="font-weight: bold;">[数据内容]</span><br /><br />$name = &quot;heiyeluren&quot;;<br />$content = &quot;MySQL支持数个存储引擎作为对不同表的类型的处理器。MySQL存储引擎包括处理事务安全表的引擎和处理非事务安全表的引擎：&middot; MyISAM管理非事务表。它提供高速存储和检索，以及全文搜索能力。MyISAM在所有MySQL配置里被支持，它是默认的存储引擎，除非你配置MySQL默认使用另外一个引擎。 &middot;MEMORY存储引擎提供&ldquo;内存中&rdquo;表。MERGE存储引擎允许集合将被处理同样的MyISAM表作为一个单独的表。就像MyISAM一样，MEMORY和MERGE存储引擎处理非事务表，这两个引擎也都被默认包含在MySQL中。 释：MEMORY存储引擎正式地被确定为HEAP引擎。&middot; InnoDB和BDB存储引擎提供事务安全表。BDB被包含在为支持它的操作系统发布的MySQL-Max二进制分发版里。InnoDB也默认被包括在所有MySQL 5.1二进制分发版里，你可以按照喜好通过配置MySQL来允许或禁止任一引擎。&middot;EXAMPLE存储引擎是一个&ldquo;存根&rdquo;引擎，它不做什么。你可以用这个引擎创建表，但没有数据被存储于其中或从其中检索。这个引擎的目的是服务，在MySQL源代码中的一个例子，它演示说明如何开始编写新存储引擎。同样，它的主要兴趣是对开发者。&quot;;<br /><br /><br /><span style="font-weight: bold;">[插入数据-1] (innodb_flush_log_at_trx_commit=1)</span><br />MyISAM 1W：3/s<br />InnoDB 1W：219/s<br /><br />MyISAM 10W：29/s<br />InnoDB 10W：2092/s<br /><br />MyISAM 100W：287/s<br />InnoDB 100W：没敢测试<br /><br style="font-weight: bold;" /><span style="font-weight: bold;">[插入数据-2] (innodb_flush_log_at_trx_commit=0)</span><br />MyISAM 1W：3/s<br />InnoDB 1W：3/s<br /><br />MyISAM 10W：30/s<br />InnoDB 10W：29/s<br /><br />MyISAM 100W：273/s<br />InnoDB 100W：423/s<br /><br /><span style="font-weight: bold;">[插入数据3] (innodb_buffer_pool_size=1024M)</span><br />InnoDB 1W：3/s<br />InnoDB 10W：33/s<br />InnoDB 100W：607/s<br /><br /><span style="font-weight: bold;">[插入数据4] (innodb_buffer_pool_size=256M, innodb_flush_log_at_trx_commit=1, set autocommit=0)</span><br /><br />InnoDB 1W：3/s<br />InnoDB 10W：26/s<br />InnoDB 100W：379/s<br /><br /><br /><br /><span style="font-weight: bold;">[MySQL 配置文件] (缺省配置)</span><br /><br />
<div style="border: 0.5pt solid windowtext; padding: 4px 5.4pt; background: rgb(230, 230, 230) none repeat scroll 0% 50%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; width: 95%;">
<div><span style="color: rgb(0, 0, 0);">#&nbsp;MySQL&nbsp;Server&nbsp;Instance&nbsp;Configuration&nbsp;File<br /></span><span style="color: rgb(128, 0, 0); font-weight: bold;">[</span><span style="color: rgb(128, 0, 0);">client</span><span style="color: rgb(128, 0, 0); font-weight: bold;">]</span><span style="color: rgb(0, 0, 0);"><br />port</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">3306</span><span style="color: rgb(0, 0, 0);"><br /><br /></span><span style="color: rgb(128, 0, 0); font-weight: bold;">[</span><span style="color: rgb(128, 0, 0);">mysql</span><span style="color: rgb(128, 0, 0); font-weight: bold;">]</span><span style="color: rgb(0, 0, 0);"><br />default-character-set</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">gbk<br /><br /></span><span style="color: rgb(128, 0, 0); font-weight: bold;">[</span><span style="color: rgb(128, 0, 0);">mysqld</span><span style="color: rgb(128, 0, 0); font-weight: bold;">]</span><span style="color: rgb(0, 0, 0);"><br />port</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">3306</span><span style="color: rgb(0, 0, 0);"><br />basedir</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&quot;</span><span style="color: rgb(0, 0, 0);">C:/mysql50/</span><span style="color: rgb(0, 0, 0);">&quot;</span><span style="color: rgb(0, 0, 0);"><br />datadir</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&quot;</span><span style="color: rgb(0, 0, 0);">C:/mysql50/Data/</span><span style="color: rgb(0, 0, 0);">&quot;</span><span style="color: rgb(0, 0, 0);"><br />default-character-set</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">gbk<br />default-storage-engine</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">INNODB<br />sql-mode</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&quot;</span><span style="color: rgb(0, 0, 0);">STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</span><span style="color: rgb(0, 0, 0);">&quot;</span><span style="color: rgb(0, 0, 0);"><br />max_connections</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">100</span><span style="color: rgb(0, 0, 0);"><br /><br />query_cache_size</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);"><br />table_cache</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">256</span><span style="color: rgb(0, 0, 0);"><br />tmp_table_size</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">50M<br />thread_cache_size</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">8</span><span style="color: rgb(0, 0, 0);"><br />myisam_max_sort_file_size</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">100G<br />myisam_max_extra_sort_file_size</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">100G<br />myisam_sort_buffer_size</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">100M<br />key_buffer_size</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">82M<br />read_buffer_size</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">64K<br />read_rnd_buffer_size</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">256K<br />sort_buffer_size</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">256K<br /><br />innodb_additional_mem_pool_size</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">4M<br />innodb_flush_log_at_trx_commit</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">1</span><span style="color: rgb(0, 0, 0);"><br />innodb_log_buffer_size</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">2M<br />innodb_buffer_pool_size</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">159M<br />innodb_log_file_size</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">80M<br />innodb_thread_concurrency</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">8</span></div>
</div>
<br /><br /><br /><br /><span style="font-weight: bold;">【总结】</span><br /><br />可以看出在MySQL 5.0里面，MyISAM和InnoDB存储引擎性能差别并不是很大，针对InnoDB来说，影响性能的主要是 innodb_flush_log_at_trx_commit 这个选项，如果设置为1的话，那么每次插入数据的时候都会自动提交，导致性能急剧下降，应该是跟刷新日志有关系，设置为0效率能够看到明显提升，当然，同样你可以SQL中提交&ldquo;SET AUTOCOMMIT = 0&rdquo;来设置达到好的性能。另外，还听说通过设置innodb_buffer_pool_size能够提升InnoDB的性能，但是我测试发现没有特别明显的提升。<br /><br />基本上我们可以考虑使用InnoDB来替代我们的MyISAM引擎了，因为InnoDB自身很多良好的特点，比如事务支持、存储过程、视图、行级锁定等等，在并发很多的情况下，相信InnoDB的表现肯定要比MyISAM强很多，当然，相应的在my.cnf中的配置也是比较关键的，良好的配置，能够有效的加速你的应用。<br /><br />如果不是很复杂的Web应用，非关键应用，还是可以继续考虑MyISAM的，这个具体情况可以自己斟酌。<br /><br style="font-style: italic;" /><br style="font-style: italic;" /><span style="font-style: italic;">参考URL：</span><br style="font-style: italic;" /><span style="font-style: italic;">http://dev.mysql.com/doc/refman/5.1/zh/index.html</span><br style="font-style: italic;" /><span style="font-style: italic;">http://dev.mysql.com/doc/refman/5.1/zh/storage-engines.html#innodb</span><br style="font-style: italic;" /><br style="font-style: italic;" /><span style="font-style: italic;">&nbsp;</span>


<pre>
referer: http://blog.csdn.net/heiyeshuwu/article/details/1559640
</pre>
