---
layout: post
title: "MySQL中利用外键实现级联删除、更新"
categories: 数据库
tags: [mysql, mysql级联操作]
date: 2014-12-17 13:06:07
---

<span><font face="Times New Roman">MySQL</font></span><span style="font-family: 宋体;">中利用外键实现级联删除、更新</span></font></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><font size="3"><span lang="EN-US"><font face="Times New Roman">MySQL</font></span><span style="font-family: 宋体;">支持外键的存储引擎只有</span><span lang="EN-US"><font face="Times New Roman">InnoDB</font></span><span style="font-family: 宋体;">，在创建外键的时候，要求父表必须有对应的索引，子表在创建外键的时候也会自动创建对应的索引。在创建索引的时候，可以指定在删除、更新父表时，对子表进行的相应操作，包括</span><span lang="EN-US"><font face="Times New Roman">RESTRICT</font></span><span style="font-family: 宋体;">、</span><span lang="EN-US"><font face="Times New Roman">NO ACTION</font></span><span style="font-family: 宋体;">、</span><span lang="EN-US"><font face="Times New Roman">SET NULL</font></span><span style="font-family: 宋体;">和</span><span lang="EN-US"><font face="Times New Roman">CASCADE</font></span><span style="font-family: 宋体;">。其中</span><span lang="EN-US"><font face="Times New Roman">RESTRICT</font></span><span style="font-family: 宋体;">和</span><span lang="EN-US"><font face="Times New Roman">NO ACTION</font></span><span style="font-family: 宋体;">相同，是指在子表有关联记录的情况下父表不能更新；</span><font color="#ff0000"><span lang="EN-US"><font face="Times New Roman">CASCADE</font></span><span style="font-family: 宋体;">表示父表在更新或者删除时，更新或者删除子表对应记录；</span></font><span lang="EN-US"><font face="Times New Roman">SET NULL</font></span><span style="font-family: 宋体;">则是表示父表在更新或者删除的时候，子表的对应字段被</span><span lang="EN-US"><font face="Times New Roman">SET NULL</font></span><span style="font-family: 宋体;">。</span></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><font size="3"><span style="font-family: 宋体;">因为只有</span><span lang="EN-US"><font face="Times New Roman">InnoDB</font></span><span style="font-family: 宋体;">引擎才允许使用外键，所以，我们的数据表必须使用</span><span lang="EN-US"><font face="Times New Roman">InnoDB</font></span><span style="font-family: 宋体;">引擎。我所使用的版本是</span><span lang="EN-US"><font face="Times New Roman">Mysql5.1</font></span><span style="font-family: 宋体;">版本的，过程如下：</span></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span style="font-family: 宋体;"><font size="3">创建数据库：</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">Create database test;</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><font size="3"><span style="font-family: 宋体;">创建两个表，其中第一个表的</span><span lang="EN-US"><font face="Times New Roman">”id”</font></span><span style="font-family: 宋体;">是第二个表（</span><span lang="EN-US"><font face="Times New Roman">userinfo</font></span><span style="font-family: 宋体;">）的外键：</span></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">CREATE TABLE `user` (</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font size="3"><font face="Times New Roman"><span style="">&nbsp; </span>`id` int(4) NOT NULL,</font></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font size="3"><font face="Times New Roman"><span style="">&nbsp; </span>`sex` enum('f','m') DEFAULT NULL,</font></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font size="3"><font face="Times New Roman"><span style="">&nbsp; </span><span style="">&nbsp;</span>PRIMARY KEY (`id`)</font></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 36.75pt;"><span lang="EN-US"><font face="Times New Roman" size="3">) ENGINE=InnoDB DEFAULT CHARSET=latin1;</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><!--?xml:namespace prefix = o ns = "urn:schemas-microsoft-com:office:office" /--><o:p><font face="Times New Roman" size="3">&nbsp;</font></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">CREATE TABLE `userinfo` (</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font size="3"><font face="Times New Roman"><span style="">&nbsp; </span>`sn` int(4) NOT NULL AUTO_INCREMENT,</font></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font size="3"><font face="Times New Roman"><span style="">&nbsp; </span>`userid` int(4) NOT NULL,</font></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font size="3"><font face="Times New Roman"><span style="">&nbsp; </span>`info` varchar(20) DEFAULT NULL,</font></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font size="3"><font face="Times New Roman"><span style="">&nbsp; </span>PRIMARY KEY (`sn`),</font></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font size="3"><font face="Times New Roman"><span style="">&nbsp; </span>KEY `userid` (`userid`),</font></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt 31.5pt; text-indent: -10.5pt;"><span lang="EN-US"><font size="3"><font face="Times New Roman"><span style="">&nbsp; </span>CONSTRAINT `userinfo_ibfk_1` FOREIGN KEY (`userid`) REFERENCES `user` (`id`) ON DELETE CASCADE ON UPDATE CASCADE</font></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 31.5pt;"><span lang="EN-US"><font face="Times New Roman" size="3">) ENGINE=InnoDB DEFAULT CHARSET=latin1;</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><o:p><font face="Times New Roman" size="3">&nbsp;</font></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><b style=""><span style="font-family: 宋体;"><font size="3">注意：</font></span></b><font size="3"><span lang="EN-US"><font face="Times New Roman"> <br>1</font></span><span style="font-family: 宋体;">、存储引擎必须使用</span><span lang="EN-US"><font face="Times New Roman">InnoDB</font></span><span style="font-family: 宋体;">引擎；</span></font><font size="3"><span lang="EN-US"><font face="Times New Roman"> <br>2</font></span><span style="font-family: 宋体;">、外键必须建立索引；</span></font><font size="3"><span lang="EN-US"><font face="Times New Roman"> <br>3</font></span><span style="font-family: 宋体;">、外键绑定关系这里使用了</span><span lang="EN-US"><font face="Times New Roman">“&nbsp;ON&nbsp;DELETE&nbsp;CASCADE ” “ON UPDATE CASCADE”</font></span><span style="font-family: 宋体;">，意思是如果外键对应数据被删除或者更新时，将关联数据完全删除或者相应地更新。更多信息请参考</span><span lang="EN-US"><font face="Times New Roman">MySQL</font></span><span style="font-family: 宋体;">手册中关于</span><span lang="EN-US"><font face="Times New Roman">InnoDB</font></span><span style="font-family: 宋体;">的文档；</span></font><font size="3"><span lang="EN-US"><font face="Times New Roman"> <br><br></font></span><span style="font-family: 宋体;">好，接着我们再来插入数据测试：</span></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span lang="EN-US"><font face="Times New Roman" size="3">INSERT&nbsp;INTO&nbsp;`user`&nbsp;(`id`,`sex`)<br>&nbsp;&nbsp;VALUES&nbsp;('1',&nbsp;'f'),&nbsp;&nbsp;('2',&nbsp;'m'),&nbsp;('3',&nbsp;'f');</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><br><font face="Times New Roman" size="3">INSERT&nbsp;INTO&nbsp;`userinfo`&nbsp;(`sn`,`userid`,`info`)<br>&nbsp;&nbsp;VALUES &nbsp;('1',&nbsp;'1',&nbsp;'2005054dsf'),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="">&nbsp;&nbsp;&nbsp; </span>&nbsp;&nbsp; &nbsp;('2',&nbsp;'1',&nbsp;'fdsfewfdsfds'),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="">&nbsp;&nbsp;&nbsp; </span>&nbsp; &nbsp;('3',&nbsp;'1',&nbsp;'gdsgergergrtre'),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>&nbsp;('4',&nbsp;'2',&nbsp;'et34t5435435werwe'),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>&nbsp;('5',&nbsp;'2',&nbsp;'435rtgtrhfghfg'),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="">&nbsp;&nbsp;&nbsp; </span>&nbsp;&nbsp;&nbsp;('6',&nbsp;'2',&nbsp;'ret345tr4345'),<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>&nbsp;&nbsp;&nbsp;('7',&nbsp;'3',&nbsp;'fgbdfvbcbfdgr'),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="">&nbsp;&nbsp;&nbsp; </span>&nbsp;&nbsp;('8',&nbsp;'3',&nbsp;'45r2343234were'),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="">&nbsp;&nbsp;&nbsp; </span>&nbsp;&nbsp;&nbsp;&nbsp;('9',&nbsp;'3',&nbsp;'wfyhtyjtyjyjy');</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><font size="3"><span style="font-family: 宋体;">我们先看一下当前数据表的状态：</span><span lang="EN-US"><font face="Times New Roman"> </font></span></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">mysql&gt; show tables;</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----------------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">| Tables_in_test |</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----------------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">| user<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">| userinfo<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----------------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">2 rows in set (0.00 sec)</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt 21pt;"><font size="3"><span lang="EN-US"><font face="Times New Roman">User</font></span><span style="font-family: 宋体;">表中的数据：</span></font><span lang="EN-US"><br><font face="Times New Roman" size="3">mysql&gt; select * from user;</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----+------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">| id | sex<span style="">&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----+------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>1 | f<span style="">&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>2 | m<span style="">&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>3 | f<span style="">&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----+------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">3 rows in set (0.00 sec)</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><font size="3"><span lang="EN-US"><font face="Times New Roman">Userinfo</font></span><span style="font-family: 宋体;">表中的数据：</span></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">mysql&gt; select * from userinfo;</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----+--------+-------------------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">| sn | userid | info<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----+--------+-------------------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>1 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>1 | 2005054dsf<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>2 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>1 | fdsfewfdsfds<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>3 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>1 | gdsgergergrtre<span style="">&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>4 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>2 | et34t5435435werwe |</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>5 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>2 | 435rtgtrhfghfg<span style="">&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>6 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>2 | ret345tr4345<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>7 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>3 | fgbdfvbcbfdgr<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>8 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>3 | 45r2343234were<span style="">&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>9 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>3 | wfyhtyjtyjyjy<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----+--------+-------------------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">9 rows in set (0.00 sec)</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span style="font-family: 宋体;"><font size="3">对于建立以上不表，相信对大家也没什么难度了。好的，下面我们就要试验我们的级联删除功能了。</font></span><font size="3"><span lang="EN-US"><font face="Times New Roman"> <br><span style="">&nbsp; </span></font></span><span style="font-family: 宋体;">我们将删除</span><span lang="EN-US"><font face="Times New Roman">user</font></span><span style="font-family: 宋体;">表中</span><span lang="EN-US"><font face="Times New Roman">id</font></span><span style="font-family: 宋体;">为</span><span lang="EN-US"><font face="Times New Roman">2</font></span><span style="font-family: 宋体;">的数据记录，看看</span><span lang="EN-US"><font face="Times New Roman">userinf</font></span><span style="font-family: 宋体;">表中</span><span lang="EN-US"><font face="Times New Roman">userid</font></span><span style="font-family: 宋体;">为</span><span lang="EN-US"><font face="Times New Roman">2</font></span><span style="font-family: 宋体;">的相关子纪录是否会自动删除：</span></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span style="font-family: 宋体;"><font size="3">执行删除操作成功！</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">mysql&gt; delete from `user` where `id`='2';</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">Query OK, 1 row affected (0.03 sec)</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><font size="3"><span style="font-family: 宋体;">看看</span><span lang="EN-US"><font face="Times New Roman">user</font></span><span style="font-family: 宋体;">表中已经没有</span><span lang="EN-US"><font face="Times New Roman">id</font></span><span style="font-family: 宋体;">为</span><span lang="EN-US"><font face="Times New Roman">2</font></span><span style="font-family: 宋体;">的数据记录了！</span></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">mysql&gt; select * from user;</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----+------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">| id | sex<span style="">&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----+------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>1 | f<span style="">&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>3 | f<span style="">&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----+------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">2 rows in set (0.00 sec)</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><font size="3"><span style="font-family: 宋体;">再看看</span><span lang="EN-US"><font face="Times New Roman">userinfo</font></span><span style="font-family: 宋体;">表中已经没有</span><span lang="EN-US"><font face="Times New Roman">userid</font></span><span style="font-family: 宋体;">为</span><span lang="EN-US"><font face="Times New Roman">2</font></span><span style="font-family: 宋体;">的</span><span lang="EN-US"><font face="Times New Roman">3</font></span><span style="font-family: 宋体;">条数据记录了，对应数据确实自动删除了！</span></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">mysql&gt; select * from userinfo;</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----+--------+----------------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">| sn | userid | info<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----+--------+----------------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>1 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>1 | 2005054dsf<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>2 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>1 | fdsfewfdsfds<span style="">&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>3 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>1 | gdsgergergrtre |</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>7 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>3 | fgbdfvbcbfdgr<span style="">&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>8 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>3 | 45r2343234were |</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>9 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>3 | wfyhtyjtyjyjy<span style="">&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----+--------+----------------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">6 rows in set (0.00 sec)</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><font size="3"><span style="font-family: 宋体;">更新的操作也类似，因为我们在前面建表的时候已经定义外键删除、更新操作都是</span><span lang="EN-US"><font face="Times New Roman">CASCADE</font></span><span style="font-family: 宋体;">，所以在这里可以直接测试数据。</span></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><font size="3"><span style="font-family: 宋体;">将</span><span lang="EN-US"><font face="Times New Roman">user</font></span><span style="font-family: 宋体;">表中原来</span><span lang="EN-US"><font face="Times New Roman">id</font></span><span style="font-family: 宋体;">为</span><span lang="EN-US"><font face="Times New Roman">1</font></span><span style="font-family: 宋体;">的数据记录更改为</span><span lang="EN-US"><font face="Times New Roman">id</font></span><span style="font-family: 宋体;">为</span><span lang="EN-US"><font face="Times New Roman">4</font></span><span style="font-family: 宋体;">，执行如下：</span></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">mysql&gt; update user set id=4 where id='1';</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">Query OK, 1 row affected (0.03 sec)</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">Rows matched: 1<span style="">&nbsp; </span>Changed: 1<span style="">&nbsp; </span>Warnings: 0</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span style="font-family: 宋体;"><font size="3">现在去看看两个表中是数据是否发生了变化：</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">mysql&gt; select * from user;</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----+------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">| id | sex<span style="">&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----+------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>3 | f<span style="">&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>4 | f<span style="">&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----+------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">2 rows in set (0.00 sec)</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><o:p><font face="Times New Roman" size="3">&nbsp;</font></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">mysql&gt; select * from userinfo;</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----+--------+----------------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">| sn | userid | info<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----+--------+----------------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>1 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>4 | 2005054dsf<span style="">&nbsp;&nbsp;&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>2 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>4 | fdsfewfdsfds<span style="">&nbsp;&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>3 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>4 | gdsgergergrtre |</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>7 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>3 | fgbdfvbcbfdgr<span style="">&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>8 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>3 | 45r2343234were |</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">|<span style="">&nbsp; </span>9 |<span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>3 | wfyhtyjtyjyjy<span style="">&nbsp; </span>|</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">+----+--------+----------------+</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span lang="EN-US"><font face="Times New Roman" size="3">6 rows in set (0.00 sec)</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-family: 宋体;"><font size="3">&nbsp;&nbsp;&nbsp; 比较原来的表可以发现它们的确已经更新成功了，测试完成！！！这也就实现了用外键对多个相关联的表做同时删除、更新的操作，从而保证了数据的一致性。</font></span></p>
